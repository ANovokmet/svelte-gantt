<div class="column-header-row" style="width:{width}px">
    {#each headers as header}
        <div class="column-header" style="width:{header.width}px" on:click="fire('selectDateTime', { from: header.from, to: header.to, unit: header.unit })">
            {header.label || 'N/A'}
        </div>
    {/each}
</div>
<style>
    .column-header-row {
        box-sizing: border-box;
        white-space: nowrap;
        overflow: hidden;

        height: 32px;
    }

    .column-header {
        position: relative;
        display: inline-block;
        height: 100%;
        box-sizing: border-box;
        text-overflow: clip;
        /* vertical-align: top; */
        text-align: center;

        display: inline-flex;
        justify-content: center;
        align-items: center;
        font-size: 1em;    
        font-size: 14px;
        font-weight: 300;
        transition: background 0.2s;

        cursor: pointer;     
        user-select: none;
    }

    .column-header:hover {
        background: #f9f9f9;
    }
    
</style>
<script>
    import { getPositionByDate } from "./utils/utils";
    
    export default {
        data(){
            return {
                headers: [],
                width: null
            }
        },
        computed: {
            columnWidth: ({$from, $to, $width, header}) => {
                return getPositionByDate($from.clone().add(header.offset || 1, header.unit), $from, $to, $width);
            },
            columnCount: ({$width, columnWidth}) => Math.ceil($width / columnWidth),
            headers: ({$from, columnWidth, columnCount, header, $width}) => {
                const headers = [];
                let headerTime = $from.clone().startOf(header.unit);
                const step = header.offset || 1;

                for(let i = 0; i < columnCount; i++){
                    headers.push({
                        width: Math.min(columnWidth, $width), 
                        label: headerTime.format(header.format),
                        from: headerTime.clone(),
                        to: headerTime.clone().add(step, header.unit),
                        unit: header.unit
                    });
                    headerTime.add(step, header.unit);
                }
                return headers;
            }
        }
    };
</script>