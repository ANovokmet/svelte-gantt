<div class="dependency" style="left:{0}px;top:{0}px;">
    <Arrow 
        {startX}
        {startY}
        {endX}
        {endY}/>
</div>

<style>
    .dependency {
		position: absolute;     
        width:100%;
        height: 100%;
	}
</style>
<script>
    import Arrow from './Arrow.html';
    import { Utils } from "./task.js";

    function subscribe(dependency, task) {
        if(!task.dependencies) {
            task.dependencies = []
        }
        task.dependencies.push(dependency);
    }

    export default {
        setup(component){
            component.subscribe = subscribe;
        },
        components: { Arrow },
        oncreate() {
            
            this.update();

            this.on('update', ({ changed, current, previous }) => {
                console.log('DOM updated after state change', changed);
                this.update();
            });

            const { fromTask, toTask } = this.get();
            subscribe(this, fromTask);
            subscribe(this, toTask);
        },
        /*data(){
            return {
            }
        }/*,
        computed: {
			startX:   ({ fromTask }) => fromTask.left + fromTask.width,
			endX: ({ toTask }) => toTask.left,
            startY: ({ fromTask, $rows, $rowHeight }) => ($rows.indexOf(fromTask.row) + 0.5) * $rowHeight,
            endY: ({ toTask, $rows, $rowHeight }) => ($rows.indexOf(toTask.row) + 0.5) * $rowHeight
        }*/
        methods: {
            update() {
                const { rows, rowHeight } = this.store.get();
                const { fromTask, toTask } = this.get();

                //if(fromTask && fromTask.left && toTask.left){
                    let startX = fromTask.left + fromTask.width;
                    let endX = toTask.left;

                    let startIndex = rows.indexOf(fromTask.row); 
                    let endIndex = rows.indexOf(toTask.row); 

                    let startY = (startIndex + 0.5) * rowHeight
                    let endY = (endIndex + 0.5) * rowHeight

                    this.set({startX, startY, endX, endY});
                //}
            }
        }
    };
</script>