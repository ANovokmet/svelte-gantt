<div class="dependency-container">
    {#each visibleDependencies as dependency (dependency.id)}
        <Dependency {...dependency}/>
    {/each}
</div>

<style>
    .dependency-container {
        position: absolute;
        width: 100%;
        height: 100%;
        
        pointer-events: none;
        top: 0;
        float: left;
        overflow: hidden;
        z-index: 0;
    }
</style>

<script>
    import Dependency from './Dependency.html';

    export default {
        components: { Dependency },
        setup(component) {
            component.type = 'body';
        },
        data() {
            return {
                visibleDependencies: []
            }
        },
        computed: {
            visibleDependencies: ({ paddingTop, $dependencies, $visibleHeight, $taskMap }) => {
                const result = [];
                for (let i = 0; i < $dependencies.length; i++) {
                    const dependency = $dependencies[i];

                    const fromTask = $taskMap[dependency.fromId];
                    const toTask = $taskMap[dependency.toId];
                    if (fromTask && (fromTask.top > paddingTop && fromTask.top <= paddingTop + $visibleHeight)) {
                        result.push(dependency);
                    } else if (toTask && (toTask.top > paddingTop && toTask.top <= paddingTop + $visibleHeight)) {
                        result.push(dependency);
                    }
                }

                return result;
            }
        }
    };
</script>