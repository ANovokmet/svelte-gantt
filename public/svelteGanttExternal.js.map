{"version":3,"file":"svelteGanttExternal.js","sources":["../src/domUtils.js","../src/ExternalDiv.js"],"sourcesContent":["export class DOMUtils {\r\n    isTaskVisible() {\r\n\r\n    }\r\n    \r\n    isRowVisible() {\r\n\r\n    }\r\n\r\n    //get mouse position within the element\r\n    static getRelativePos(node, event) {\r\n        const rect = node.getBoundingClientRect();\r\n        const x = event.clientX - rect.left; //x position within the element.\r\n        const y = event.clientY - rect.top;  //y position within the element.\r\n        return {\r\n            x: x,\r\n            y: y\r\n        }\r\n    }\r\n\r\n    //does mouse position intersect element\r\n    static intersects(node, event) {\r\n    }\r\n\r\n    static addEventListenerOnce(target, type, listener, addOptions, removeOptions) {\r\n        target.addEventListener(type, function fn(event) {\r\n            target.removeEventListener(type, fn, removeOptions);\r\n            listener.apply(this, arguments, addOptions);\r\n        });\r\n    }\r\n}","import { DOMUtils } from \"./domUtils.js\";\r\n    \r\n    let SvelteGanttExternal;\r\n\r\n    function drag(node, data) {\r\n        const { gantt } = data;    \r\n        const windowElement = window;\r\n\r\n        let successful = false;\r\n        //TODO make these functions gantt instance specific\r\n        const onmouseenter = (e) => {\r\n            successful = true; \r\n        };\r\n        const onmouseleave = (e) => {\r\n            successful = false;\r\n        };\r\n        \r\n        function onmousedown(event) {\r\n            event.preventDefault();\r\n            \r\n            const element = data.elementContent();\r\n            Object.assign(element.style, {\r\n                top: event.pageY+'px',\r\n                left: event.pageX+'px'\r\n            });\r\n            document.body.appendChild(element);\r\n            data.element = element;\r\n            data.dragging = true;\r\n\r\n            const { rowContainerElement } = gantt.store.get();\r\n            rowContainerElement.addEventListener('mouseenter', onmouseenter);\r\n            rowContainerElement.addEventListener('mouseleave', onmouseleave);\r\n\r\n            windowElement.addEventListener('mousemove', onmousemove, false);\r\n            DOMUtils.addEventListenerOnce(windowElement, 'mouseup', onmouseup);\r\n        }\r\n        \r\n        function onmousemove(event) {\r\n            event.preventDefault();\r\n            const { dragging, element } = data;\r\n            if(dragging) {\r\n                Object.assign(element.style, {\r\n                    top: event.pageY+'px',\r\n                    left: event.pageX+'px'\r\n                });\r\n            }\r\n        }\r\n\r\n        function onmouseup(event) {\r\n            const { element, onsuccess, onfail, gantt } = data;\r\n            const { rowContainerElement } = gantt.store.get();\r\n            document.body.removeChild(element);\r\n            data.dragging = false;\r\n            data.element = null;\r\n\r\n            //if over gantt\r\n            if(successful){\r\n                //create task\r\n                const rowCenterX = gantt.refs.mainContainer.getBoundingClientRect().left + gantt.refs.mainContainer.getBoundingClientRect().width / 2;\r\n                \r\n                const mousePos = DOMUtils.getRelativePos(rowContainerElement, event);\r\n                const dropDate = gantt.utils.getDateByPosition(mousePos.x);\r\n\r\n                //TODO extract into helper, used in Task\r\n                let elements = document.elementsFromPoint(rowCenterX, event.clientY);\r\n                let rowElement = elements.find((element) => element.classList.contains('row'));\r\n                if(rowElement !== undefined) {\r\n                    const { visibleRows } = gantt.store.get();\r\n                    const targetRow = visibleRows.find((r) => r.rowElement === rowElement);\r\n                    onsuccess(targetRow, dropDate, gantt);\r\n                }\r\n            }\r\n            else{\r\n                onfail();\r\n                //fail, return indicator to ex-div\r\n                //remove task if created\r\n            }\r\n\r\n            rowContainerElement.removeEventListener('mouseenter', onmouseenter);\r\n            rowContainerElement.removeEventListener('mouseleave', onmouseleave);\r\n            windowElement.removeEventListener('mousemove', onmousemove, false);\r\n        }\r\n\r\n        node.addEventListener('mousedown', onmousedown, false);\r\n\r\n        return {\r\n            update() {\r\n                \r\n            },\r\n            destroy() {\r\n                node.removeEventListener('mousedown', onmousedown, false);\r\n                //windowElement.removeEventListener('mousemove', onmousemove, false);\r\n                node.removeEventListener('mousemove', onmousemove, false);\r\n                node.removeEventListener('mouseup', onmouseup, false);\r\n            }\r\n        }\r\n    }\r\n\r\n    SvelteGanttExternal = {};\r\n\r\n    SvelteGanttExternal.defaults = {\r\n        // draggable elements\r\n        elements: [],\r\n        // called when dragged over a row \r\n        onsuccess: (targetRow, dropDate, gantt) => { },\r\n        // called when dragged outside main gantt area\r\n        onfail: () => { },\r\n        // factory function, creates HTMLElement \r\n        elementContent: () => {\r\n            const element = document.createElement('div');\r\n            element.innerHTML = 'New Task';\r\n            Object.assign(element.style, {\r\n                position: 'absolute',\r\n                background: '#eee',\r\n                padding: '0.5em 1em',\r\n                fontSize: '12px',\r\n                pointerEvents: 'none',\r\n            });\r\n            return element;\r\n        },\r\n        // gantt to bind this draggable to\r\n        gantt: null\r\n    }\r\n\r\n    SvelteGanttExternal.create = function(element, options){\r\n        const data = Object.assign({}, SvelteGanttExternal.defaults, options);\r\n\r\n        drag(element, data);\r\n        /*return new SvelteGanttExternal({\r\n            target: element,\r\n        });*/\r\n    }\r\n\r\n    export default SvelteGanttExternal;"],"names":[],"mappings":"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"}