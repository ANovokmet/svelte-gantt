{"version":3,"file":"svelteGanttExternal.js","sources":["../../src/utils/domUtils.ts","../../src/ExternalDiv.ts"],"sourcesContent":["export class DOMUtils {\r\n    isTaskVisible() {\r\n\r\n    }\r\n    \r\n    isRowVisible() {\r\n\r\n    }\r\n\r\n    static isLeftClick(event) {\r\n        return event.which === 1;\r\n    }\r\n\r\n    //get mouse position within the element\r\n    static getRelativePos(node: HTMLElement, event: MouseEvent) {\r\n        const rect = node.getBoundingClientRect();\r\n        const x = event.clientX - rect.left; //x position within the element.\r\n        const y = event.clientY - rect.top;  //y position within the element.\r\n        return {\r\n            x: x,\r\n            y: y\r\n        }\r\n    }\r\n\r\n    //does mouse position intersect element\r\n    static intersects(node, event) {\r\n    }\r\n\r\n    static addEventListenerOnce(target: HTMLElement|Window, type: string, listener, addOptions?, removeOptions?) {\r\n        target.addEventListener(type, function fn(event) {\r\n            target.removeEventListener(type, fn, removeOptions);\r\n            listener.apply(this, arguments, addOptions);\r\n        });\r\n    }\r\n}","import { DOMUtils } from \"./utils/domUtils.js\";\r\n    \r\nlet SvelteGanttExternal;\r\n\r\nfunction drag(node, data) {\r\n    const { gantt } = data;    \r\n    const windowElement = window;\r\n\r\n    let successful = false;\r\n    //TODO make these functions gantt instance specific\r\n    const onmouseenter = (e) => {\r\n        successful = true; \r\n    };\r\n    const onmouseleave = (e) => {\r\n        successful = false;\r\n    };\r\n    \r\n    function onmousedown(event) {\r\n        if(!data.enabled){\r\n            return;\r\n        }\r\n\r\n        event.preventDefault();\r\n        \r\n        const element = data.elementContent();\r\n        Object.assign(element.style, {\r\n            top: event.pageY+'px',\r\n            left: event.pageX+'px'\r\n        });\r\n        document.body.appendChild(element);\r\n        data.element = element;\r\n        data.dragging = true;\r\n\r\n        const { rowContainerElement } = gantt.store.get();\r\n        rowContainerElement.addEventListener('mouseenter', onmouseenter);\r\n        rowContainerElement.addEventListener('mouseleave', onmouseleave);\r\n\r\n        windowElement.addEventListener('mousemove', onmousemove, false);\r\n        DOMUtils.addEventListenerOnce(windowElement, 'mouseup', onmouseup);\r\n    }\r\n    \r\n    function onmousemove(event) {\r\n        event.preventDefault();\r\n        const { dragging, element } = data;\r\n        if(dragging) {\r\n            Object.assign(element.style, {\r\n                top: event.pageY+'px',\r\n                left: event.pageX+'px'\r\n            });\r\n        }\r\n    }\r\n\r\n    function onmouseup(event) {\r\n        const { element, onsuccess, onfail, gantt } = data;\r\n        const { rowContainerElement } = gantt.store.get();\r\n        document.body.removeChild(element);\r\n        data.dragging = false;\r\n        data.element = null;\r\n\r\n        //if over gantt\r\n        if(successful){\r\n            //create task\r\n            const rowCenterX = gantt.refs.mainContainer.getBoundingClientRect().left + gantt.refs.mainContainer.getBoundingClientRect().width / 2;\r\n            \r\n            const mousePos = DOMUtils.getRelativePos(rowContainerElement, event);\r\n            const dropDate = gantt.utils.getDateByPosition(mousePos.x);\r\n\r\n            //TODO extract into helper, used in Task\r\n            let elements = document.elementsFromPoint(rowCenterX, event.clientY);\r\n            let rowElement = elements.find((element) => element.classList.contains('row'));\r\n            if(rowElement !== undefined) {\r\n                const { visibleRows } = gantt.store.get();\r\n                const targetRow = visibleRows.find((r) => r.rowElement === rowElement);\r\n                onsuccess(targetRow, dropDate, gantt);\r\n            }\r\n        }\r\n        else{\r\n            onfail();\r\n            //fail, return indicator to ex-div\r\n            //remove task if created\r\n        }\r\n\r\n        rowContainerElement.removeEventListener('mouseenter', onmouseenter);\r\n        rowContainerElement.removeEventListener('mouseleave', onmouseleave);\r\n        windowElement.removeEventListener('mousemove', onmousemove, false);\r\n    }\r\n\r\n    node.addEventListener('mousedown', onmousedown, false);\r\n\r\n    return {\r\n        update() {\r\n            \r\n        },\r\n        destroy() {\r\n            node.removeEventListener('mousedown', onmousedown, false);\r\n            //windowElement.removeEventListener('mousemove', onmousemove, false);\r\n            node.removeEventListener('mousemove', onmousemove, false);\r\n            node.removeEventListener('mouseup', onmouseup, false);\r\n        }\r\n    }\r\n}\r\n\r\nSvelteGanttExternal = {};\r\n\r\nSvelteGanttExternal.defaults = {\r\n    // if enabled\r\n    enabled: true,\r\n    // called when dragged over a row \r\n    onsuccess: (targetRow, dropDate, gantt) => { },\r\n    // called when dragged outside main gantt area\r\n    onfail: () => { },\r\n    // factory function, creates HTMLElement \r\n    elementContent: () => {\r\n        const element = document.createElement('div');\r\n        element.innerHTML = 'New Task';\r\n        Object.assign(element.style, {\r\n            position: 'absolute',\r\n            background: '#eee',\r\n            padding: '0.5em 1em',\r\n            fontSize: '12px',\r\n            pointerEvents: 'none',\r\n        });\r\n        return element;\r\n    },\r\n    // gantt to bind this draggable to\r\n    gantt: null\r\n}\r\n\r\nSvelteGanttExternal.create = function(element: HTMLElement, options){\r\n    const data = Object.assign({}, SvelteGanttExternal.defaults, options);\r\n\r\n    drag(element, data);\r\n    /*return new SvelteGanttExternal({\r\n        target: element,\r\n    });*/\r\n    return data;\r\n}\r\n\r\nexport default SvelteGanttExternal;"],"names":[],"mappings":"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"}